---
title: "Final Project"
author: "Denali Stevens"
date: "2024-04-19"
image: "nps.jpeg"
---
```{r}
#| echo: false
#| output: false
#| warning: false

## Packages and data for first map 
library(sf)
library(tidyverse)
library(leaflet)
library(here)
library(plotly)
library(glue)
# I downloaded the data from this website and used the shp file 
# https://public-nps.opendata.arcgis.com/datasets/nps::nps-boundary-4/explore?location=37.015375%2C-81.906543%2C6.00
nps <- sf::read_sf("NPS_shape/nps_boundary.shp") |>
  sf::st_transform('+proj=longlat +datum=WGS84')

# data for joined map of just national parks with more information
# created in CleaningData.qmd
load("joined_map_data.rda")

# Create labels that users see when clicking on a park 
label_text <- glue(
  "<b> Name: </b> {joined_clean$UNIT_NAME}<br/>",
  "<b> Established: </b> {joined_clean$Established}<br/>",
  "<b> Visitors in 2022: </b> {joined_clean$Visitors_2022}<br/>",
  "<b> Description: </b> {joined_clean$Description}<br/>") |>
  lapply(htmltools::HTML)

library("httr")
library("readxl")
library(scales)
library(plotly)
options(scipen = 999)
GET("https://query.data.world/s/fr5k6pcrcweo7wr657vchbeq6f3cci?dws=00000", write_disk(tf <- tempfile(fileext = ".xlsx")))
df <- read_excel(tf)

top10_total <- df |> filter(YearRaw == "Total") |>
  filter(`Unit Type` == "National Park") |>
  arrange(YearRaw) |>
  slice(1:10) |>
  pull(`Unit Name`)

top10_plot <- df |>
  filter(`Unit Name` %in% top10_total)

np_visitors <- top10_plot |> 
  rename(Year = YearRaw) |> 
  rename(Type = `Unit Type`) |> 
  rename(Name = `Unit Name`) |>
  filter(Type == "National Park") |>
  filter(Year != "Total") |>
  filter(Year >= 1995 & Year <= 2016) 


```


# Introduction

This blog post includes some information and visuals from my final project exploring areas managed by the National Park Service. Most of my interest in this project is regarding areas with the title "National Park", but it also includes some information about other recreational areas the National Park Service manages. These areas includes historic parks, military parks, monuments, trails, and a few other classifications. My visualizations include a map, data tables, and two visitors plots. 

# Visualizations 
For the map I started by using the shape file provided by the National Park Service to plot all of these areas and give a small popup to inform the user of what they are. However, using that large of a file (over 400 areas) was too big to be exported so I created a map with just the areas with the the title of national park. For a share able version of the map I scraped a Wikipedia page about national parks to gain some more information about this group of 62 areas, like their size, visitor count in 2022, date of establishment, and a brief description of the park. I then had to clean the names of all the areas listed in the large shape file to get rid of any extra text so I could join the new information with the file by the name of the national parks. By doing this I could create a map of just true national parks that has more information about each area in its popup window. 

```{r}
#| echo: false

leaflet(nps) |>
      setView(lng = -110, lat = 39.833, zoom = 2.5) |>
      addTiles() |>
      addProviderTiles(providers$OpenStreetMap.Mapnik) |>
      addPolygons(color = "#006400",
                  weight = 1.5,
                  smoothFactor = .5,
                  opacity = 1.0, 
                  fillOpacity = 0.5,
                  highlightOptions = highlightOptions(color = "#003b00", weight = 2,
                                                      bringToFront = TRUE),
                  label = joined_clean$UNIT_NAME,
                  popup = label_text,
                  data = joined_clean)

```

My shiny app also has data tables that accompany the map. There are two different tables a user can choose to view. One provides the expansive list of all areas managed by the National Park Service and allows the user to select different classifications and states, and to sort by the unit name, type, or state. The other data table is populated with information about the true national parks that is pulled from the Wikipedia page. If the user chooses to look at this list they can select by state, and sort by name, state, established date, area, or visitors in 2022. Here is a sample of the data table used for true national parks, it only shows a few parks but is a good idea of how the table works. 
```{r}
#| echo: false
#| warning: false

library(DT)
library(sf)
load("joined_display.rda")
example <- head(joined_display, 3) |>
  st_drop_geometry()

datatable(example)
```

If the user wants to look further into the record of visitors to the parks there are two plots that demonstrate more information about them. This data came from a separate file provided by the National Park Service and it contains data from 1906 through 2016 about roughly 400 areas the service manages. This includes the expansive list containing the array of areas that I wanted the original map to cover. But given I can only show more information about true national parks in the map I chose to limit the visitor information to the same data set I used in the map. The more interesting visual for this information is a line graph where the user can choose which parks they want to view and they can alter the year range they are interested in looking at. I did limit this range to be from 1995 to 2016 instead of the entire data set to simplify it and only keep more relevant information. This version only shows 10 parks, which had the highest total visitors in the dataset. 
```{r}
#| echo: false
#| 
v_plot <- ggplot(data = np_visitors, aes(x = Year, y = Visitors, group = Name,
                                             label = Name,
                                             label2 = Year,
                                             label3 = Visitors)) +
      geom_line(aes(color = Name), show.legend = FALSE) +
      scale_color_viridis_d() +
      scale_y_continuous(labels = scales::comma) +
      labs(title = "Visitors in National Parks from 1995 to 2016") +
      theme(legend.position = "none")
    ggplotly(v_plot, tooltip = c("label", "label2", "label3"))
```

In the shiny version this map appears empty and grows as the user selects more parks to plot, reducing the clutter and makes it easier to view the parks they are interested in. It also allows the user to play with the year range a little using a slider bar if they are only interested in a few years instead of a 20 year span. The other visitors graph is built to be more specific and shows a bar graph for a single park, allowing for the selection of any one park but it is set from 1995 to 2016. 

The full versions of each visual can be found on the <https://denali01.shinyapps.io/final_app/>. 

# Questions 

The idea behind building this shiny app was a to provide a very basic education of the national parks in the United States. Through the information provided in the app, one can follow along and answer some given questions to test their knowledge. I came up with just a few quick questions to get the idea across of how it can be used and the knowledge a user can gain. Here are a few of the questions one would be able to answer using the shiny app: 

1. What is the oldest national park and when was it established?
```{r}
#| code-fold: true

# Yellowstone. It was established on March 1, 1872
```

2. What is the newest national park and when was it established?
```{r}
#| code-fold: true

# White Sands. It was established on December 20, 2019
```

3. Select 3 of your favorite parks
  a. Which one had the most visitors in 2000? How many did it have?
  b. How about the most visitors in 2016? Is it the same park as part a?


4. Looking specifically at Yellowstone National Park
  a. What year did it record the most visitors in this time period?
```{r}
#| code-fold: true

# In 2016, with 4,257,177 visitors 
```
  b. What year did it record the least visitors?
```{r}
#| code-fold: true

# In 2001, with 2,758,526
```

The full question sheet is available on my github <https://github.com/DenaliStevens/ds334_finalProject>. 